<!DOCTYPE html>
<html>
  <head>
    <title>WiFi Analyzer - Alerts</title>
    <style>
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        color: white;
        margin: 0;
        padding: 20px;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
      }

      h1 {
        text-align: center;
        color: #4a9eff;
        margin-bottom: 10px;
      }

      .nav-tabs {
        display: flex;
        gap: 10px;
        margin-bottom: 30px;
        justify-content: center;
      }

      .nav-tabs a {
        color: white;
        text-decoration: none;
        padding: 10px 20px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 5px;
        transition: background 0.3s;
      }

      .nav-tabs a:hover,
      .nav-tabs a.active {
        background: #4a9eff;
      }

      .alert-container {
        background: rgba(255, 255, 255, 0.03);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        padding: 20px;
        margin-bottom: 20px;
      }

      .alert-item {
        background: rgba(255, 255, 255, 0.05);
        border-left: 4px solid;
        padding: 15px;
        margin: 10px 0;
        border-radius: 5px;
      }

      .alert-warning {
        border-left-color: #f59e0b;
        background: rgba(245, 158, 11, 0.1);
      }

      .alert-error {
        border-left-color: #ef4444;
        background: rgba(239, 68, 68, 0.1);
      }

      .alert-info {
        border-left-color: #3b82f6;
        background: rgba(59, 130, 246, 0.1);
      }

      .alert-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
      }

      .alert-title {
        font-weight: bold;
        font-size: 1.1em;
      }

      .alert-time {
        color: #aaa;
        font-size: 0.9em;
      }

      .alert-message {
        margin: 10px 0;
      }

      .alert-data {
        background: rgba(0, 0, 0, 0.3);
        padding: 10px;
        border-radius: 5px;
        font-family: monospace;
        font-size: 0.9em;
        margin-top: 10px;
      }

      .severity-badge {
        display: inline-block;
        padding: 3px 10px;
        border-radius: 12px;
        font-size: 0.8em;
        font-weight: bold;
        text-transform: uppercase;
      }

      .severity-warning {
        background: #f59e0b;
        color: white;
      }

      .severity-error {
        background: #ef4444;
        color: white;
      }

      .severity-info {
        background: #3b82f6;
        color: white;
      }

      .no-alerts {
        text-align: center;
        color: #4ade80;
        font-size: 1.2em;
        padding: 40px;
      }

      .check-button {
        background: #4a9eff;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 1em;
        margin-bottom: 20px;
      }

      .check-button:hover {
        background: #357abd;
      }

      .stats {
        display: flex;
        gap: 20px;
        margin-bottom: 20px;
        justify-content: center;
      }

      .stat-box {
        background: rgba(255, 255, 255, 0.05);
        padding: 15px 30px;
        border-radius: 10px;
        text-align: center;
      }

      .stat-number {
        font-size: 2em;
        font-weight: bold;
        color: #4a9eff;
      }

      .stat-label {
        color: #aaa;
        font-size: 0.9em;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ðŸš¨ WiFi Analyzer - Alerts</h1>

      <div class="nav-tabs">
        <a href="/">Static View</a>
        <a href="/interactive">Interactive View</a>
        <a href="/alerts" class="active">Alerts</a>
      </div>

      <div style="text-align: center">
        <button class="check-button" onclick="checkAlerts()">
          ðŸ”„ Check for New Alerts
        </button>
      </div>

      <div class="stats">
        <div class="stat-box">
          <div class="stat-number" id="alertCount">{{ alerts|length }}</div>
          <div class="stat-label">Total Alerts (24h)</div>
        </div>
        <div class="stat-box">
          <div class="stat-number" id="warningCount">
            {{ alerts | selectattr("severity", "equalto", "warning") | list |
            length }}
          </div>
          <div class="stat-label">Warnings</div>
        </div>
        <div class="stat-box">
          <div class="stat-number" id="errorCount">
            {{ alerts | selectattr("severity", "equalto", "error") | list |
            length }}
          </div>
          <div class="stat-label">Errors</div>
        </div>
      </div>

      <div class="alert-container">
        <h2 style="color: #4a9eff; margin-top: 0">
          Recent Alerts (Last 24 Hours)
        </h2>

        {% if alerts %} {% for alert in alerts | reverse %}
        <div class="alert-item alert-{{ alert.severity }}">
          <div class="alert-header">
            <div class="alert-title">
              <span class="severity-badge severity-{{ alert.severity }}"
                >{{ alert.severity }}</span
              >
              {{ alert.type | replace("_", " ") | title }}
            </div>
            <div class="alert-time">{{ alert.timestamp }}</div>
          </div>
          <div class="alert-message">{{ alert.message }}</div>
          {% if alert.data %}
          <div class="alert-data">
            {% for key, value in alert.data.items() %}
            <div><strong>{{ key }}:</strong> {{ value }}</div>
            {% endfor %}
          </div>
          {% endif %}
        </div>
        {% endfor %} {% else %}
        <div class="no-alerts">
          âœ… No alerts in the last 24 hours - Everything looks good!
        </div>
        {% endif %}
      </div>

      <footer style="text-align: center; margin-top: 40px; color: #666">
        <p>Raspberry Pi Zero 2 W WiFi Analysis System</p>
      </footer>
    </div>

    <script>
      async function checkAlerts() {
        const button = event.target;
        button.disabled = true;
        button.textContent = "â³ Checking...";

        try {
          const response = await fetch("/api/alerts/check");
          const data = await response.json();

          if (data.count > 0) {
            alert(`Found ${data.count} new alert(s)! Refreshing page...`);
            location.reload();
          } else {
            button.textContent = "âœ… No New Alerts";
            setTimeout(() => {
              button.textContent = "ðŸ”„ Check for New Alerts";
              button.disabled = false;
            }, 2000);
          }
        } catch (error) {
          alert("Error checking alerts: " + error);
          button.textContent = "ðŸ”„ Check for New Alerts";
          button.disabled = false;
        }
      }

      // Auto-refresh every 5 minutes
      setTimeout(() => location.reload(), 5 * 60 * 1000);
    </script>
  </body>
</html>
